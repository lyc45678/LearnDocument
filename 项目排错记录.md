#### é”™è¯¯ä¸€ï¼š

```bash
root@liuchong:/# nginx -t
nginx: [alert] could not open error log file: open() "/var/log/nginx/error.log" failed (2: No such file or directory)
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
2025/10/10 21:14:58 [emerg] 50715#0: open() "/var/log/nginx/error.log" failed (2: No such file or directory)
nginx: configuration file /etc/nginx/nginx.conf test failed
```

##### é”™è¯¯åŸå› ï¼š

Nginx éœ€è¦çš„æ—¥å¿—ç›®å½•ä¸å­˜åœ¨

##### è§£å†³æ–¹æ¡ˆï¼š

- æ£€æŸ¥Nginxé…ç½®ä¸­çš„ç”¨æˆ·é…ç½®

```
head -n 5 /etc/nginx/nginx.conf
```

- åˆ›å»ºå¿…è¦çš„ç›®å½•ç»“æ„

```
# åˆ›å»º Nginx æ—¥å¿—ç›®å½•
sudo mkdir -p /var/log/nginx
```

- è®¾ç½®æ­£ç¡®çš„æƒé™

```
# è®¾ç½® root ç”¨æˆ·å¯¹æ—¥å¿—ç›®å½•çš„æƒé™
sudo chown -R root:root /var/log/nginx
```

æ¡¥æ¥æ¨¡å¼éœ€è¦å»ºç«‹æ¡¥æ¥å™¨è™šæ‹Ÿç½‘å¡

##### å®‰è£…é“¶æ²³éº’éºŸç³»ç»Ÿéœ€è¦ä¿®æ”¹çš„é…ç½®

1.åˆ›å»º/confbakç›®å½•ï¼Œå…»æˆä¿®æ”¹é…ç½®æ–‡ä»¶æå‰å¤‡ä»½ä¹ æƒ¯

```cpp
mkdir /confbak
cp /etc/selinux/config /confbak
```

2.æ‰§è¡Œå‘½ä»¤å…³é—­

```bash
systemctl stop firewalld
systemctl disable firewalld
setenforce 0
sed -i 's/enforcing/disabled/g' /etc/selinux/config
```

3.ç½‘ç»œé…ç½®

1.æŸ¥çœ‹è‡ªå·±çš„ç½‘å¡åç§°

```bash
ip a|grep ens |awk '{print $2}'
```

ä¸€èˆ¬æ˜¯ens33

2.å¤‡ä»½

```bash
cp /etc/sysconfig/network-scripts/ifcfg-ens33 /confbak
```

3.æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¦‚ä¸Šä¸€æ­¥ç½‘å¡åå­—æ˜¯å…¶ä»–å°†ens33æ‰‹åŠ¨æ”¹ä¸ºå…¶ä»–æ‰§è¡Œ

```bash
echo "IPADDR=192.168.8.10" >> /etc/sysconfig/network-scripts/ifcfg-ens33
echo "NETMASK=255.255.255.0" >> /etc/sysconfig/network-scripts/ifcfg-ens33
echo "GATEWAY=192.168.8.2" >> /etc/sysconfig/network-scripts/ifcfg-ens33
echo "DNS1=8.8.8.8" >> /etc/sysconfig/network-scripts/ifcfg-ens33
echo "DNS2=114.114.114.114" >> /etc/sysconfig/network-scripts/ifcfg-ens33
sed -i 's/IPV6/#&/' /etc/sysconfig/network-scripts/ifcfg-ens33
sed -i 's/dhcp/static/' /etc/sysconfig/network-scripts/ifcfg-ens33
sed -i 's/ONBOOT=no/ONBOOT=yes/' /etc/sysconfig/network-scripts/ifcfg-ens33
```

æ³¨ï¼šæœ€åä¸€è¡Œå‘½ä»¤æ˜¯è§£å†³æ¯æ¬¡å¼€æœºç½‘å¡ä¸èƒ½å¯åŠ¨ éœ€è¦æ‰‹åŠ¨æ‰èƒ½èµ·æ¥ï¼ŒONBOOTç”±noæ”¹ä¸ºyesè§£å†³

4.é‡å¯ç½‘å¡ç”Ÿæ•ˆé…ç½®

```bash
systemctl restart network
```

æ³¨æ„ç½‘å¡å°‘ç”¨ifdown æˆ–è€…systemctl stopï¼Œç”Ÿäº§ç¯å¢ƒå¤§å¤šä¸æ˜¯ç›´è¿æœåŠ¡å™¨ï¼Œdownæ‰èµ·ä¸æ¥å°±å¾—è®©æœºæˆ¿ç›´è¿......

ä¸ƒã€å¯ä½¿ç”¨cockpité€šè¿‡webé¡µé¢ç®¡ç†ç›‘æ§

éº’éºŸv10ä¹Ÿè‡ªå¸¦äº†Cockpitï¼ŒCockpit æ˜¯ä¸€ä¸ªå¼€æºçš„æœåŠ¡å™¨ç®¡ç†å·¥å…·ï¼Œä¸»è¦ç”¨äºç®€åŒ– LinuxæœåŠ¡å™¨ çš„ç®¡ç†å’Œç›‘æ§ã€‚å®ƒæä¾›äº†ä¸€ä¸ªåŸºäºWebçš„ç”¨æˆ·ç•Œé¢ï¼Œä½¿ç³»ç»Ÿç®¡ç†å‘˜èƒ½å¤Ÿé€šè¿‡ç½‘é¡µæµè§ˆå™¨è½»æ¾åœ°ç®¡ç†å’Œç›‘æ§æœåŠ¡å™¨çš„çŠ¶æ€ã€æ€§èƒ½å’Œé…ç½®â€Œâ€Œã€‚

1.ç¡®è®¤é˜²ç«å¢™å·²ç¦ç”¨

2.å¯åŠ¨cockpit

```bash
systemctl enable --now cockpit.socket
```

æˆåŠŸä¼šè¿”å›

Created symlink /etc/systemd/system/sockets.target.wants/cockpit.socket â†’ /usr/lib/systemd/system/cockpit.socket.

3.æµè§ˆå™¨è®¿é—®

https://192.168.8.10:9090,å¡«å†™ç”¨æˆ·ååŠå¯†ç 

#### å®‰è£…VMtools

- **æŒ‚è½½VMware Toolså…‰ç›˜** åœ¨VMware Workstationä¸­ï¼Œç‚¹å‡»èœå•æ çš„ è™šæ‹Ÿæœº > å®‰è£… VMware Toolsã€‚ ç³»ç»Ÿä¼šè‡ªåŠ¨åŠ è½½ä¸€ä¸ªåŒ…å«å®‰è£…åŒ…çš„è™šæ‹Ÿå…‰ç›˜ã€‚
- **å¤åˆ¶å®‰è£…åŒ…** æ‰“å¼€è™šæ‹Ÿæœºä¸­çš„å…‰é©±ç›®å½•ï¼Œæ‰¾åˆ° VMwareTools-<ç‰ˆæœ¬å·>.tar.gz æ–‡ä»¶ã€‚ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†å…¶å¤åˆ¶åˆ° /opt/ ç›®å½•ï¼š cp /mnt/cdrom/VMwareTools-*.tar.gz /opt/
- **è§£å‹å®‰è£…åŒ…** è¿›å…¥ /opt/ ç›®å½•å¹¶è§£å‹æ–‡ä»¶ï¼š cd /opt/ tar -xvf VMwareTools-*.tar.gz
- **è¿è¡Œå®‰è£…è„šæœ¬** è¿›å…¥è§£å‹åçš„ç›®å½• vmware-tools-distribï¼š cd vmware-tools-distrib æ‰§è¡Œå®‰è£…è„šæœ¬ï¼š sudo ./vmware-install.pl æŒ‰æç¤ºä¸€è·¯å›è½¦å®Œæˆå®‰è£…ã€‚
- **é‡å¯è™šæ‹Ÿæœº** å®‰è£…å®Œæˆåï¼Œé‡å¯ç³»ç»Ÿä»¥åº”ç”¨æ›´æ”¹ï¼š sudo reboot

æ‰“å¼€ens33ç½‘å¡ï¼Œè¿è¡Œyum install -y open-vm-tools open-vm-tools-desktopå³å¯

è™šæ‹Ÿæœºç½‘ç»œé—®é¢˜ï¼š

é‡å¯ç½‘ç»œï¼šsystemctl restart NetworkManager

åœ¨windowä¸Šé…ç½®è™šæ‹Ÿç½‘å¡ï¼Œä¸è™šæ‹Ÿæœºä¸Šçš„ç½‘å¡é…ç½®ç›¸åŒå³å¯

#### å®‰è£…tomcat

å®¿ä¸»æœºå‘è™šæ‹Ÿæœºä¸­ä¼ è¾“æ–‡ä»¶å¯ä»¥å¼€å¯å…±äº«æ–‡ä»¶å¤¹ï¼ŒæŒ‡å®šå¯¹åº”ä¸»æœºè·¯å¾„å³å¯ï¼Œåœ¨è™šæ‹Ÿæœºä¸­è®¿é—®/mnt/hgfs

æ‹¿åˆ°å¯¹åº”çš„taråŒ…ï¼Œåœ¨æŒ‡å®šç›®å½•ä¸‹è§£å‹å³å¯

tar -xvf apache-tomcat-7.0.0.104.tar.gz -C /opt/java

![image-20251014163440164](https://cdn.jsdelivr.net/gh/lyc45678/image@master/img/20251014163514213.png)

ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆsource ~/.bashrc

é—®é¢˜å‘ç°ï¼š

å°†æ–‡ä»¶æ‹·å…¥webappsç›®å½•åï¼Œå‘ç°æ— æ³•æ­£å¸¸æ‰“å¼€

ç»è¿‡æŸ¥çœ‹æ—¥å¿—å¾—å‡ºï¼Œæ•°æ®åº“è¿æ¥å¤±è´¥

ç»è¿‡æŸ¥è¯¢å‘ç°rs5000ç”¨æˆ·æœªåˆ›å»ºï¼Œåˆ›å»ºä¹‹åé‡å¯Tomcatï¼Œé—®é¢˜è§£å†³

åœ¨ç½‘å€ä¸Šè®¿é—®æƒé™æœåŠ¡ï¼Œå‘ç°æ˜¾ç¤ºé¡µé¢è¿‡æœŸç­‰é”™è¯¯

ç»è¿‡å¸®å¿™ï¼Œå°†mysqlæ•°æ®åº“åŒºåˆ†å¤§å°å†™å…³é—­å³å¯ã€‚

##### å¯ç”¨tomcatæœåŠ¡

###### åˆ›å»ºæœåŠ¡æ–‡ä»¶

```bash
vi /etc/systemd/system/tomcat.service
```

###### 2. æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```ini
[Unit]
Description=Apache Tomcat 7
After=network.target

[Service]
Type=forking
Environment=JAVA_HOME=/opt/java/jdk1.8.0_461
Environment=CATALINA_HOME=/opt/java/apache-tomcat-7.0.104
Environment=CATALINA_BASE=/opt/java/apache-tomcat-7.0.104
Environment="JAVA_OPTS=-Xms256m -Xmx256m -XX:MaxMetaspaceSize=128m -XX:+UseG1GC -XX:MaxGCPauseMillis=200"
ExecStart=/opt/java/apache-tomcat-7.0.104/bin/startup.sh
ExecStop=/opt/java/apache-tomcat-7.0.104/bin/shutdown.sh
User=root
Group=root
Restart=on-failure
RestartSec=10
UMask=0007

[Install]
WantedBy=multi-user.target
```

###### é‡æ–°åŠ è½½systemdé…ç½®

```bash
systemctl daemon-reload
```

è®¾ç½®å¼€æœºè‡ªå¯

```bash
systemctl enable tomcat.service
```

#### é…ç½®JDK

åŒæ ·æ˜¯åœ¨å®¿ä¸»æœºä¸‹è½½taråŒ…ï¼Œæ”¾åœ¨shareç›®å½•ä¸‹ï¼Œå†ç”±è™šæ‹Ÿæœºå»è§£å‹å¾—åˆ°å¯¹åº”jdkå®‰è£…åŒ…

tar -xvf jdk1.8.0_461.tar.gz -C /opt/java

é…ç½®ç¯å¢ƒå˜é‡

![image-20251014171702132](https://cdn.jsdelivr.net/gh/lyc45678/image@master/img/20251014171954166.png)

åˆ·æ–°é…ç½®æ–‡ä»¶ç”Ÿæ•ˆsource /etc/profile

#### å®‰è£…Nginx

æ£€æŸ¥ä¾èµ–

gcc\make ç­‰ç¼–è¯‘å·¥å…·

```csharp
[root@localhost ~]# gcc --version
```

> gcc (GCC) 7.3.0
> Copyright Â© 2017 Free Software Foundation, Inc.
> æœ¬ç¨‹åºæ˜¯è‡ªç”±è½¯ä»¶ï¼›è¯·å‚çœ‹æºä»£ç çš„ç‰ˆæƒå£°æ˜ã€‚æœ¬è½¯ä»¶æ²¡æœ‰ä»»ä½•æ‹…ä¿ï¼›
> åŒ…æ‹¬æ²¡æœ‰é€‚é”€æ€§å’ŒæŸä¸€ä¸“ç”¨ç›®çš„ä¸‹çš„é€‚ç”¨æ€§æ‹…ä¿ã€‚

å·²å®‰è£…ã€‚

```csharp
[root@localhost ~]# make --version
```

> GNU Make 4.3
> ä¸º x86_64-koji-linux-gnu ç¼–è¯‘
> Copyright (C) 1988-2020 Free Software Foundation, Inc.
> è®¸å¯è¯ï¼šGPLv3+ï¼šGNU é€šç”¨å…¬å…±è®¸å¯è¯ç¬¬ 3 ç‰ˆæˆ–æ›´æ–°ç‰ˆæœ¬http://gnu.org/licenses/gpl.htmlã€‚
> æœ¬è½¯ä»¶æ˜¯è‡ªç”±è½¯ä»¶ï¼šæ‚¨å¯ä»¥è‡ªç”±ä¿®æ”¹å’Œé‡æ–°å‘å¸ƒå®ƒã€‚
> åœ¨æ³•å¾‹å…è®¸çš„èŒƒå›´å†…æ²¡æœ‰å…¶ä»–ä¿è¯ã€‚

å·²å®‰è£…ã€‚

æ£€æŸ¥ PCRE åº“

```csharp
[root@localhost ~]# pcre-config --version
```

> 8.44

å·²å®‰è£…ã€‚

æ£€æŸ¥ zlib åº“

```cpp
[root@localhost ~]# ls /usr/include/zlib.h 2>/dev/null && echo "âœ“ zlib å¤´æ–‡ä»¶å­˜åœ¨" || echo "âœ— zlib å¤´æ–‡ä»¶ç¼ºå¤±"
```

> /usr/include/zlib.h
> âœ“ zlib å¤´æ–‡ä»¶å­˜åœ¨

å·²å®‰è£…ã€‚

æ£€æŸ¥ OpenSSL åº“

```undefined
openssl version
```

> OpenSSL 1.1.1f 31 Mar 2020

å·²å®‰è£…ã€‚

å®‰è£…Nginx

```undefined
tar -zxvf nginx-1.24.0.tar.gz -C /opt/java
```

åˆ‡æ¢åˆ° nginx çš„ç›®å½•å†…ã€‚ä»æºä»£ç ç¼–è¯‘å®‰è£…ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šè¾“å‡ºä¸€å †ç¼–è¯‘è¿‡ç¨‹ã€‚

```bash
cd /opt/java/nginx-1.24.0
./configure && make && make install
```

éªŒè¯å®‰è£… nginx æ˜¯å¦æˆåŠŸã€‚

```bash
/usr/local/nginx/sbin/nginx -v
```

> nginx version: nginx/1.24.0

å¯åŠ¨ nginxã€‚

```bash
/usr/local/nginx/sbin/nginx
```

æ£€æŸ¥æ˜¯å¦å¯åŠ¨æˆåŠŸã€‚

```xml
[root@localhost nginx-1.24.0]# curl http://localhost
```

![image-20251014221828089](https://cdn.jsdelivr.net/gh/lyc45678/image@master/img/20251014221828179.png)

**é…ç½® nginx ä¸ºç³»ç»ŸæœåŠ¡**

ç¼–è¾‘ service æ–‡ä»¶ã€‚

```bash
vim /usr/lib/systemd/system/nginx.service
```

ä¿å­˜ä¸‹é¢å†…å®¹åˆ° service æ–‡ä»¶ä¸­ã€‚

```ini
[Unit]
Description=nginx service
After=network.target

[Service]
Type=forking
ExecStart=/usr/local/nginx/sbin/nginx
ExecReload=/usr/local/nginx/sbin/nginx -s reload
ExecStop=/usr/local/nginx/sbin/nginx -s stop
PrivateTmp=true

[Install]
WantedBy=multi-user.target
```

é‡æ–°åŠ è½½ systemd çš„å•å…ƒé…ç½®æ–‡ä»¶ã€‚

```undefined
systemctl daemon-reload
```

å¯åŠ¨ nginx æœåŠ¡ã€‚

```sql
systemctl start nginx.service
```

å¦‚æœæç¤ºä¸‹é¢è¿™æ®µï¼Œå¯èƒ½æ˜¯ä½ å‰é¢å¯åŠ¨ nginx å¿˜è®°åœæ‰äº†ã€‚

> Job for nginx.service failed because the control process exited with error code.
> See "systemctl status nginx.service" and "journalctl -xe" for details.

æŸ¥çœ‹æœåŠ¡çŠ¶æ€ã€‚

```lua
systemctl status nginx.service
```

å°†æœåŠ¡é…ç½®ä¸ºå¼€æœºå¯åŠ¨ã€‚

```bash
systemctl enable nginx.service
```

> Created symlink /etc/systemd/system/multi-user.target.wants/nginx.service â†’ /usr/lib/systemd/system/nginx.service.

æŸ¥çœ‹é…ç½®æ–‡ä»¶ä½ç½®ã€‚

```bash
/usr/local/nginx/sbin/nginx -t
# é€šè¿‡è¿”å›ç»“æœæŸ¥çœ‹é…ç½®æ–‡ä»¶ è¿™ä¸ªå‘½ä»¤å…¶å®æ˜¯ç”¨äºæ£€æµ‹é…ç½®æ–‡ä»¶æ˜¯å¦åˆæ³•
```

> nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok
> nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful

ä¿®æ”¹Nginxé…ç½®æ–‡ä»¶

ä½¿ç”¨å¯¹åº”é¡¹ç›®çš„é…ç½®æ–‡ä»¶

ä½¿ç”¨scpå‘½ä»¤

```
scp /etc/nginx/conf.d/nginxserver.conf root@192.168.16.10:/opt/java/share
```

æ‹¿åˆ°é…ç½®æ–‡ä»¶ä¹‹åï¼Œ

åœ¨/usr/local/nginx/conf/nginx.confä¸­åœ¨http{}å—ä¹‹å†…ï¼Œserver{}å—ä¹‹å¤–æ·»åŠ 

```
include /usr/local/nginx/conf/nginxserver.conf
```

ç„¶ånginx-tæ£€æµ‹ï¼Œå¯ä»¥æˆåŠŸè¿è¡Œ

##### é…ç½®æ—¥å¿—æ–‡ä»¶

å¯åŠ¨æ—¥å¿—é…ç½®

åœ¨ `nginx.conf` çš„ `http` å—ä¸­æ·»åŠ ï¼š

nginx.conf

```
http {
    # å®šä¹‰æ—¥å¿—æ ¼å¼
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';
  
    log_format extended '$remote_addr - $remote_user [$time_local] "$request" '
                        '$status $body_bytes_sent "$http_referer" '
                        '"$http_user_agent" "$http_x_forwarded_for" '
                        '"$request_time" "$upstream_response_time"';

    # å¯ç”¨è®¿é—®æ—¥å¿—å’Œé”™è¯¯æ—¥å¿—
    access_log /var/log/nginx/access.log main;
    error_log  /var/log/nginx/error.log warn;
  
    # å…¶ä»–é…ç½®...
}
```

Serverå—ä¸­çš„æ—¥å¿—é…ç½®

nginx

```conf
server {
    listen       80;
    server_name  localhost;

    # å½“å‰serverçš„è®¿é—®æ—¥å¿—
    access_log  /var/log/nginx/host.access.log main;
    access_log  /var/log/nginx/host.access-extended.log extended;
  
    # å½“å‰serverçš„é”™è¯¯æ—¥å¿—
    error_log   /var/log/nginx/host.error.log notice;

    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
    }
```

åˆ›å»ºæ—¥å¿—ç›®å½•å’Œè®¾ç½®æƒé™

```xml
# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p /var/log/nginx

# è®¾ç½®æƒé™
chown -R nginx:nginx /var/log/nginx
chmod 755 /var/log/nginx

# åˆ›å»ºæ—¥å¿—æ–‡ä»¶
touch /var/log/nginx/{access,error,localhost.access,localhost.error,api.access}.log
chown nginx:nginx /var/log/nginx/*.log
```

ç«‹å³ç”Ÿæ•ˆé…ç½®

```
# 1. æ£€æŸ¥é…ç½®è¯­æ³•
nginx -t

# 2. é‡æ–°åŠ è½½é…ç½®
nginx -s reload
```

#### å®‰è£…MySQL

1) æŸ¥çœ‹æ˜¯å¦å·²å®‰è£… mariadbï¼Œè‹¥æ˜¯å·²å®‰è£…ï¼Œéœ€è¦å¸è½½

```
# rpm -qa|grep mariad
```

è¦æ˜¯æœ‰ï¼Œå¸è½½ mariadb

```
# yum remove mariad
```

è§£å‹

```bash
tar -zxvf mysql-5.7.18-linux-glibc2.5-x86_64.tar.gz -C /opt/java
```

åˆ›å»ºmysqlå­˜å‚¨æ•°æ®ç›®å½•

```bash
mkdir data
```

èµ‹äºˆæƒé™

```bash
chown mysql:mysql -R  /opt/java/mysql-5.7.18-linux-glibc2.5-x86_64/data/
```

ç¼–è¾‘my.cnfæ–‡ä»¶ `vim /etc/my.cnf`

```
[mysqld]
# è®¾ç½®3306ç«¯å£
port=3306
# è®¾ç½®mysqlçš„å®‰è£…ç›®å½•
basedir=``/usr/local/mysql
# è®¾ç½®mysqlæ•°æ®åº“çš„æ•°æ®çš„å­˜æ”¾ç›®å½•
datadir=``/usr/local/mysql/data
# å…è®¸æœ€å¤§è¿æ¥æ•°
max_connections=200
# å…è®¸è¿æ¥å¤±è´¥çš„æ¬¡æ•°ã€‚
max_connect_errors=10
# æœåŠ¡ç«¯ä½¿ç”¨çš„å­—ç¬¦é›†é»˜è®¤ä¸ºutf8mb4
character-``set``-server=utf8mb4
# åˆ›å»ºæ–°è¡¨æ—¶å°†ä½¿ç”¨çš„é»˜è®¤å­˜å‚¨å¼•æ“
default-storage-engine=INNODB
# é»˜è®¤ä½¿ç”¨â€œmysql_native_passwordâ€æ’ä»¶è®¤è¯
#mysql_native_password
default_authentication_plugin=mysql_native_password
[mysql]
# è®¾ç½®mysqlå®¢æˆ·ç«¯é»˜è®¤å­—ç¬¦é›†
default-character-``set``=utf8mb4
[client]
# è®¾ç½®mysqlå®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶é»˜è®¤ä½¿ç”¨çš„ç«¯å£
port=3306
default-character-``set``=utf8mb4
```

åœ¨binç›®å½•ä¸‹åˆå§‹åŒ–MySQL

```bash
./mysqld --defaults-file=/etc/my.cnf --basedir=/opt/java/mysql-5.7.18-linux-glibc2.5-x86_64 --datadir=/opt/java/mysql-5.7.18-linux-glibc2.5-x86_64/data --user=mysql --initialize
```

åˆå§‹å¯†ç ï¼š.z4u%p.(PDC#

å¯åŠ¨MySQL

```bash
[root@localhost mysql-5.7.18-linux-glibc2.5-x86_64]# support-files/mysql.server start
Starting MySQL.Logging to '/opt/java/mysql-5.7.18-linux-glibc2.5-x86_64/data/localhost.localdomain.err'.
.. SUCCESS! 
```

```
ä¿®æ”¹åˆå§‹å¯†ç 
åˆ‡æ¢ç›®å½•
``cd /usr/local/mysql/bin``
ç™»å½•å‘½ä»¤
``./mysql-u root -p``
```

```
# è®¾ç½®å¯†ç 
SET PASSWORD = PASSWORD(``'ok'``);
# è®¾ç½®ç”¨æˆ·çš„è®¿é—®å¯†ç ç”¨ä¸è¿‡æœŸ
ALTER USER ``'root'``@``'localhost'` `PASSWORD EXPIRE NEVER;
#åˆ·æ–°æƒé™
FLUSH PRIVILEGES;
```

datagripæ— æ³•è¿æ¥è™šæ‹Ÿæœºæ•°æ®åº“

```
-- æˆ–è€…ä¿®æ”¹ç°æœ‰rootç”¨æˆ·çš„host
UPDATE mysql.user SET host='%' WHERE user='root';

-- åˆ·æ–°æƒé™
FLUSH PRIVILEGES;
```

é‡å¯MySQLä¹‹åå³å¯ã€‚

åˆ›å»ºsystemdæœåŠ¡æ–‡ä»¶

```
vi /usr/lib/systemd/system/mysql.service
```

åœ¨æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®

```
[Unit]
Description=MySQL Server
Documentation=man:mysqld(8)
Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html
After=network.target
After=syslog.target

[Install]
WantedBy=multi-user.target

[Service]
User=mysql
Group=mysql

# æ ¹æ®æ‚¨çš„å®‰è£…è·¯å¾„ä¿®æ”¹
Type=forking
PIDFile=/opt/java/mysql-5.7.18-linux-glibc2.5-x86_64/data/mysqld.pid

# å¯åŠ¨å‘½ä»¤
ExecStart=/opt/java/mysql-5.7.18-linux-glibc2.5-x86_64/bin/mysqld --defaults-file=/etc/my.cnf --daemonize

# åœæ­¢å‘½ä»¤
ExecStop=/opt/java/mysql-5.7.18-linux-glibc2.5-x86_64/bin/mysqladmin -uroot -p shutdown

# é‡å¯å‘½ä»¤
ExecReload=/bin/kill -HUP $MAINPID

# é™åˆ¶èµ„æºä½¿ç”¨
LimitNOFILE=5000

Restart=on-failure
RestartPreventExitStatus=1
PrivateTmp=false
```

é‡æ–°åŠ è½½systemdå¹¶å¯ç”¨æœåŠ¡

```
# é‡æ–°åŠ è½½systemdé…ç½®
systemctl daemon-reload

# è®¾ç½®å¼€æœºè‡ªå¯
systemctl enable mysql.service

# å¯åŠ¨MySQLæœåŠ¡
systemctl start mysql.service

# æ£€æŸ¥çŠ¶æ€
systemctl status mysql.service
```

å¸¸ç”¨ç®¡ç†å‘½ä»¤

bash

```
# å¯åŠ¨
systemctl start mysql

# åœæ­¢
systemctl stop mysql

# é‡å¯
systemctl restart mysql

# æŸ¥çœ‹çŠ¶æ€
systemctl status mysql

# æŸ¥çœ‹æ—¥å¿—
journalctl -u mysql.service -f
```

å‘ç°æŠ¥é”™

æ²¡æœ‰PIDæ–‡ä»¶

è§£å†³è¿‡ç¨‹ï¼š

æ£€æŸ¥MySQLé…ç½®ä¸­çš„PIDæ–‡ä»¶è®¾ç½®

å‘ç°æ²¡æœ‰ï¼Œå†³å®šæ·»åŠ 

```
vim /etc/my.cnf
```

åœ¨ `[mysqld]` éƒ¨åˆ†æ·»åŠ ï¼š

```
[mysqld]
pid-file = /opt/java/mysql-5.7.18-linux-glibc2.5-x86_64/data/mysqld.pid
```

æ‰‹åŠ¨åˆ›å»ºPIDæ–‡ä»¶

```
# è·å–MySQLè¿›ç¨‹ID
MYSQL_PID=$(ps aux | grep mysqld | grep -v grep | awk '{print $2}')
echo "MySQLè¿›ç¨‹ID: $MYSQL_PID"

# åˆ›å»ºPIDæ–‡ä»¶
echo $MYSQL_PID > /opt/java/mysql-5.7.18-linux-glibc2.5-x86_64/data/mysqld.pid

# è®¾ç½®æ­£ç¡®çš„æƒé™
chown mysql:mysql /opt/java/mysql-5.7.18-linux-glibc2.5-x86_64/data/mysqld.pid
chmod 644 /opt/java/mysql-5.7.18-linux-glibc2.5-x86_64/data/mysqld.pid
```

ä¿®æ”¹systemdæœåŠ¡æ–‡ä»¶

ä¿®æ”¹ä¸º

```
[Unit]
Description=MySQL Server
After=network.target

[Service]
Type=simple
User=mysql
Group=mysql
ExecStart=/opt/java/mysql-5.7.18-linux-glibc2.5-x86_64/bin/mysqld --defaults-file=/etc/my.cnf
ExecStop=/opt/java/mysql-5.7.18-linux-glibc2.5-x86_64/bin/mysqladmin -uroot -p shutdown
Restart=on-failure
RestartSec=10
TimeoutSec=300

[Install]
WantedBy=multi-user.target
```

é‡æ–°åŠ è½½å¹¶é‡å¯æœåŠ¡

é—®é¢˜è§£å†³

è®¾ç½®mysql-u root -p

```
# æ·»åŠ åˆ° ~/.bashrc
echo 'export PATH=/opt/java/mysql-5.7.18-linux-glibc2.5-x86_64/bin:$PATH' >> ~/.bashrc
echo 'export PATH=/opt/java/jdk1.8.0_461/bin:$PATH' >> ~/.bashrc

# é‡æ–°åŠ è½½é…ç½®
source ~/.bashrc

# ç°åœ¨å¯ä»¥ç›´æ¥ä½¿ç”¨
mysql -u root -p
```

æŠ¥é”™ï¼šç”±äºç‰ˆæœ¬çš„sql_modeå¹¶æ²¡æœ‰å…³é—­ï¼Œ

åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹sql_modeã€‚

é‡å¯æœåŠ¡

#### å®‰è£…nacos

ä»å®˜ç½‘ä¸Šä¸‹è½½zipå‹ç¼©åŒ…åœ¨è¿›è¡Œè§£å‹ã€‚

åœ¨binç›®å½•ä¸‹å¯åŠ¨å•æœºæ¨¡å¼

```
sh startup.sh -m standalone
```

å¼€å¯nacosé‰´æƒ

ä¿®æ”¹nacosé…ç½®æ–‡ä»¶

```
# å¼€å¯è®¤è¯
nacos.core.auth.enabled=true
nacos.core.auth.system.type=nacos

# è®¾ç½® Token å¯†é’¥ï¼ˆè‡ªå®šä¹‰ï¼Œé•¿åº¦è‡³å°‘32ä½ï¼‰
nacos.core.auth.plugin.nacos.token.secret.key=SecretKey012345678901234567890123456789012345678901234567890123456789

# ç¼“å­˜é…ç½®
nacos.core.auth.plugin.nacos.token.expire.seconds=18000
nacos.core.auth.caching.enabled=true
```

é‡å¯æœåŠ¡

./shutdown.sh

å†æ¬¡å¯åŠ¨å•æœºæ¨¡å¼

**sh startup.sh -m standalone**

nacoså¯†é’¥ï¼šVGhpc0lzQVNlY3JldEtleUZvck5hY29zQXV0aFBsdWdpbjAyMzQ1Njc4OTAxMjM0NTY3ODkw

è¿è¡ŒæŠ¥é”™

```
Whitelabel Error PageThis application has no explicit mapping for /error, so you are seeing this as a fallback.
Fri Oct 17 09:35:46 CST 2025
There was an unexpected error (type=Forbidden, status=403).
Invalid server identity key or value, Please make sure set `nacos.core.auth.server.identity.key` and `nacos.core.auth.server.identity.value`, or open `nacos.core.auth.enable.userAgentAuthWhite`
```

ä¿®æ”¹é…ç½®æ–‡ä»¶

```
nacos.core.auth.server.identity.key=serverIdentity
nacos.core.auth.server.identity.value=security
```

é‡å¯æœåŠ¡

é—®é¢˜è§£å†³

##### å¯ç”¨nacosæœåŠ¡

###### åˆ›å»ºæœåŠ¡æ–‡ä»¶

```bash
vi /etc/systemd/system/nacos.service
```

###### 2. æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```ini
[Unit]
Description=Nacos Server
After=network.target mysql.service

[Service]
Type=forking
Environment=JAVA_HOME=/opt/java/jdk1.8.0_461
Environment=CUSTOM_NACOS_MEMORY=-Xms256m -Xmx256m -Xmn128m
ExecStart=/opt/java/nacos/bin/startup.sh -m standalone
ExecStop=/opt/java/nacos/bin/shutdown.sh
User=root
Group=root
Restart=on-failure
RestartSec=10
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
```

###### é‡æ–°åŠ è½½systemdé…ç½®

```bash
systemctl daemon-reload
```

###### è®¾ç½®å¼€æœºè‡ªå¯

```bash
systemctl enable tomcat.service
```

#### è¿è¡ŒjaråŒ…

æŠ¥é”™ï¼Œå‘ç°æ•°æ®åº“ç”¨æˆ·rs5000æ— æ³•è¿æ¥ora9aæ•°æ®åº“

è§£å†³æ–¹æ¡ˆï¼šè¿›å…¥MySQLä¸­æˆæƒ

mysql> GRANT ALL PRIVILEGES ON ora9a.* TO 'rs5000'@'localhost';
Query OK, 0 rows affected (0.11 sec)

mysql> FLUSH PRIVILEGES;
Query OK, 0 rows affected (0.14 sec)

ä½¿ç”¨tmuxå·¥å…·

åˆ›å»ºè¿è¡ŒjaråŒ…è„šæœ¬

åˆ›å»ºè„šæœ¬ï¼Œå¼€æœºè‡ªå¯

##### æœåŠ¡1ï¼šsec-countermeasures

```
sudo vim /etc/systemd/system/sec-countermeasures.service
```

```
[Unit]
Description=Sec Countermeasures Service
After=network.target mysql.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/java/springboot/sec-countermeasures
ExecStart=/opt/java/jdk1.8.0_461/bin/java -jar sec-countermeasures.jar
ExecStop=/bin/kill -15 $MAINPID
Restart=always
RestartSec=10
SuccessExitStatus=143

Environment=JAVA_HOME=/opt/java/jdk1.8.0_461

[Install]
WantedBy=multi-user.target
```

##### æœåŠ¡2ï¼šsec-data-maintenance

```
sudo vim /etc/systemd/system/sec-data-maintenance.service
```

```
[Unit]
Description=Sec Data Maintenance Service
After=network.target mysql.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/java/springboot/sec-data-maintenance
ExecStart=/opt/java/jdk1.8.0_461/bin/java -jar sec-data-maintenance.jar
ExecStop=/bin/kill -15 $MAINPID
Restart=always
RestartSec=10
SuccessExitStatus=143

Environment=JAVA_HOME=/opt/java/jdk1.8.0_461

[Install]
WantedBy=multi-user.target
```

##### æœåŠ¡3ï¼šsec-inspection

```
sudo vim /etc/systemd/system/sec-inspection.service
```

```
[Unit]
Description=Sec Inspection Service
After=network.target mysql.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/java/springboot/sec-inspection
ExecStart=/opt/java/jdk1.8.0_461/bin/java -jar sec-inspection.jar
ExecStop=/bin/kill -15 $MAINPID
Restart=always
RestartSec=10
SuccessExitStatus=143

Environment=JAVA_HOME=/opt/java/jdk1.8.0_461

[Install]
WantedBy=multi-user.target
```

##### æœåŠ¡4ï¼šsec-panoramic

```
sudo vim /etc/systemd/system/sec-panoramic.service
```

```
[Unit]
Description=Sec Panoramic Service
After=network.target mysql.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/java/springboot/sec-panoramic
ExecStart=/opt/java/jdk1.8.0_461/bin/java -jar sec-panoramic.jar
ExecStop=/bin/kill -15 $MAINPID
Restart=always
RestartSec=10
SuccessExitStatus=143

Environment=JAVA_HOME=/opt/java/jdk1.8.0_461

[Install]
WantedBy=multi-user.target
```

##### æœåŠ¡5ï¼šsec-central-monitorï¼ˆæ ¹ç›®å½•çš„ï¼‰

```
sudo vim /etc/systemd/system/sec-central-monitor.service
```

```
[Unit]
Description=Sec Central Monitor Service
After=network.target mysql.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/java/springboot
ExecStart=/opt/java/jdk1.8.0_461/bin/java -jar sec_central_monitor-1.0-SNAPSHOT.jar
ExecStop=/bin/kill -15 $MAINPID
Restart=always
RestartSec=10
SuccessExitStatus=143

Environment=JAVA_HOME=/opt/java/jdk1.8.0_461

[Install]
WantedBy=multi-user.target
```

##### 2. å¯ç”¨å’Œå¯åŠ¨æ‰€æœ‰æœåŠ¡

```
# é‡æ–°åŠ è½½ systemd
sudo systemctl daemon-reload

# å¯ç”¨æ‰€æœ‰æœåŠ¡å¼€æœºè‡ªå¯
sudo systemctl enable sec-central-monitor.service
sudo systemctl enable sec-countermeasures.service
sudo systemctl enable sec-data-maintenance.service
sudo systemctl enable sec-inspection.service
sudo systemctl enable sec-panoramic.service

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
sudo systemctl start sec-central-monitor.service
sudo systemctl start sec-countermeasures.service
sudo systemctl start sec-data-maintenance.service
sudo systemctl start sec-inspection.service
sudo systemctl start sec-panoramic.service
```

##### 3. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```
# æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€
sudo systemctl status sec-central-monitor.service
sudo systemctl status sec-countermeasures.service
sudo systemctl status sec-data-maintenance.service
sudo systemctl status sec-inspection.service
sudo systemctl status sec-panoramic.service

# æˆ–è€…ä¸€é”®æŸ¥çœ‹æ‰€æœ‰çŠ¶æ€
for service in sec-central-monitor sec-countermeasures sec-data-maintenance sec-inspection sec-panoramic; do
    echo "=== $service ==="
    sudo systemctl status $service.service --no-pager -l
    echo
done
```

##### 4. åˆ›å»ºç»Ÿä¸€ç®¡ç†è„šæœ¬

```
# åˆ›å»ºç®¡ç†è„šæœ¬
sudo vim /usr/local/bin/manage-jars
```

```
#!/bin/bash

SERVICES=(
    "sec-central-monitor"
    "sec-countermeasures" 
    "sec-data-maintenance"
    "sec-inspection"
    "sec-panoramic"
)

case "$1" in
    start)
        for service in "${SERVICES[@]}"; do
            echo "å¯åŠ¨ $service..."
            sudo systemctl start $service.service
        done
        ;;
    stop)
        for service in "${SERVICES[@]}"; do
            echo "åœæ­¢ $service..."
            sudo systemctl stop $service.service
        done
        ;;
    restart)
        for service in "${SERVICES[@]}"; do
            echo "é‡å¯ $service..."
            sudo systemctl restart $service.service
        done
        ;;
    status)
        for service in "${SERVICES[@]}"; do
            echo -n "$service: "
            if sudo systemctl is-active --quiet $service.service; then
                echo -e "\033[32mè¿è¡Œä¸­\033[0m"
            else
                echo -e "\033[31mæœªè¿è¡Œ\033[0m"
            fi
        done
        ;;
    enable)
        for service in "${SERVICES[@]}"; do
            echo "å¯ç”¨ $service å¼€æœºè‡ªå¯..."
            sudo systemctl enable $service.service
        done
        ;;
    disable)
        for service in "${SERVICES[@]}"; do
            echo "ç¦ç”¨ $service å¼€æœºè‡ªå¯..."
            sudo systemctl disable $service.service
        done
        ;;
    logs)
        if [ -z "$2" ]; then
            echo "ç”¨æ³•: manage-jars logs <æœåŠ¡å>"
            echo "å¯ç”¨æœåŠ¡: ${SERVICES[*]}"
        else
            sudo journalctl -u $2.service -f
        fi
        ;;
    *)
        echo "ç”¨æ³•: manage-jars {start|stop|restart|status|enable|disable|logs}"
        echo "å¯ç”¨æœåŠ¡:"
        for service in "${SERVICES[@]}"; do
            echo "  - $service"
        done
        ;;
esac
```

```
# è®¾ç½®æ‰§è¡Œæƒé™
sudo chmod +x /usr/local/bin/manage-jars
```

##### 5. ä½¿ç”¨ç®¡ç†è„šæœ¬

```
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
manage-jars start

# æŸ¥çœ‹çŠ¶æ€
manage-jars status

# é‡å¯æ‰€æœ‰æœåŠ¡
manage-jars restart

# æŸ¥çœ‹æŸä¸ªæœåŠ¡çš„æ—¥å¿—
manage-jars logs sec-central-monitor

# å¯ç”¨å¼€æœºè‡ªå¯
manage-jars enable
```

##### jaråŒ…æ—¥å¿—æ–‡ä»¶

###### 1. åˆ›å»ºæ—¥å¿—ç›®å½•

```bash
sudo mkdir -p /var/log/sec
sudo chmod 755 /var/log/sec
```

###### 2. ä¿®æ”¹æœåŠ¡æ–‡ä»¶æ·»åŠ æ—¥å¿—é…ç½®

bash

```bash
 vim /etc/systemd/system/sec-central-monitor.service
```

**åœ¨ `Environment=JAVA_HOME...` è¿™ä¸€è¡Œä¹‹å‰æ·»åŠ ï¼š**

```
StandardOutput=file:/var/log/sec/central-monitor.log
StandardError=file:/var/log/sec/central-monitor-error.log
```

###### 3. é‡æ–°åŠ è½½å¹¶å¯åŠ¨æœåŠ¡

```bash
# é‡æ–°åŠ è½½systemdé…ç½®
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start sec-central-monitor

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status sec-central-monitor

# æŸ¥çœ‹æ—¥å¿—æ˜¯å¦ç”Ÿæˆ
ls -la /var/log/sec/

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f /var/log/sec/central-monitor.log
```

###### **æ‰¹é‡ä¿®æ”¹æ‰€æœ‰ sec æœåŠ¡**

å¦‚æœæ‚¨æƒ³ä¸ºæ‰€æœ‰ sec æœåŠ¡æ·»åŠ æ—¥å¿—é…ç½®ï¼š

```bash
# åˆ›å»ºæ‰¹é‡ä¿®æ”¹è„šæœ¬
sudo vim /tmp/add-logs-to-sec.sh
```

```bash
#!/bin/bash
SERVICES=("sec-central-monitor" "sec-countermeasures" "sec-data-maintenance" "sec-inspection" "sec-panoramic")

for service in "${SERVICES[@]}"; do
    service_file="/etc/systemd/system/${service}.service"
  
    if [[ -f "$service_file" ]]; then
        echo "å¤„ç†æœåŠ¡: $service"
  
        # åœæ­¢æœåŠ¡
        sudo systemctl stop "$service"
  
        # å¤‡ä»½
        sudo cp "$service_file" "${service_file}.backup.$(date +%Y%m%d%H%M%S)"
  
        # æ·»åŠ æ—¥å¿—é…ç½®ï¼ˆåœ¨Environmentè¡Œä¹‹å‰ï¼‰
        sudo sed -i '/^Environment=.*$/i StandardOutput=file:/var/log/sec/'"${service#sec-}"'.log' "$service_file"
        sudo sed -i '/^Environment=.*$/i StandardError=file:/var/log/sec/'"${service#sec-}"'-error.log' "$service_file"
  
        echo "  - å·²æ·»åŠ æ—¥å¿—é…ç½®"
    else
        echo "è·³è¿‡: $service_file ä¸å­˜åœ¨"
    fi
done

# é‡æ–°åŠ è½½å¹¶å¯åŠ¨æœåŠ¡
sudo systemctl daemon-reload
for service in "${SERVICES[@]}"; do
    if [[ -f "/etc/systemd/system/${service}.service" ]]; then
        sudo systemctl start "$service"
        echo "å¯åŠ¨æœåŠ¡: $service"
    fi
done

echo "å®Œæˆ!"
```

```bash
# æ‰§è¡Œè„šæœ¬
chmod +x /tmp/add-logs-to-sec.sh
sudo /tmp/add-logs-to-sec.sh
```

##### æ—¥å¿—è½®è½¬è®¾ç½®

###### 1.**åˆ›å»º logrotate é…ç½®**

```bash
sudo vim /etc/logrotate.d/sec-services
```

```bash
/var/log/sec/*.log {
    daily                      # æ¯å¤©è½®è½¬
    missingok                  # å¦‚æœæ—¥å¿—æ–‡ä»¶ä¸¢å¤±ï¼Œä¸æŠ¥é”™
    rotate 30                  # ä¿ç•™30å¤©çš„æ—¥å¿—
    compress                   # å‹ç¼©æ—§æ—¥å¿—
    delaycompress              # å»¶è¿Ÿå‹ç¼©ï¼ˆä¸‹ä¸€æ¬¡è½®è½¬æ—¶å‹ç¼©ï¼‰
    notifempty                 # å¦‚æœæ—¥å¿—ä¸ºç©ºï¼Œä¸è½®è½¬
    copytruncate               # å¤åˆ¶åæˆªæ–­åŸæ–‡ä»¶
    dateext                    # ä½¿ç”¨æ—¥æœŸä½œä¸ºåç¼€
    dateformat -%Y%m%d         # æ—¥æœŸæ ¼å¼
    size 100M                  # è¾¾åˆ°100MBä¹Ÿè½®è½¬
}
```

###### **2. æµ‹è¯•é…ç½®**

```bash
# æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•
sudo logrotate -d /etc/logrotate.d/sec-services

# æ‰‹åŠ¨ç«‹å³æ‰§è¡Œè½®è½¬
sudo logrotate -vf /etc/logrotate.d/sec-services
```

#### ä½¿ç”¨ systemd æµç¨‹ï¼ˆä»¥tmuxä¸¾ä¾‹è¯´æ˜ï¼‰

```
# åˆ›å»ºæœåŠ¡æ–‡ä»¶
sudo vim /etc/systemd/system/tmux-jar.service
```

å†…å®¹ï¼š

```
[Unit]
Description=Start JAR in tmux session
After=network.target

[Service]
Type=forking
User=root
ExecStart=/usr/bin/tmux new-session -d -s jar-service -c /root/springboot '/home/lch/jdk1.8.0_371/bin/java -jar sec_central_monitor-1.0-SNAPSHOT.jar'
ExecStop=/usr/bin/tmux kill-session -t jar-service

[Install]
WantedBy=multi-user.target
```

å¯ç”¨æœåŠ¡ï¼š

```
sudo systemctl daemon-reload
sudo systemctl enable tmux-jar.service
sudo systemctl start tmux-jar.service
```

#### æ•°æ®å®Œå¤‡åŠŸèƒ½æ— æ³•è®¿é—®

åŸå› ï¼šrs5000æ˜¯æ™®é€šç”¨æˆ·ï¼Œæ‰€ä»¥ä¸ç»™å…·ä½“çš„æ•°æ®åº“èµ‹æƒé™å°±æ— æ³•ä½¿ç”¨ã€‚

å› æ­¤éœ€è¦ç»™å…¶èµ‹æƒé™

gitæ“ä½œï¼šæ‰¾åˆ°è‡ªå·±åŸå…ˆä¿®æ”¹å¹¶æäº¤

```bash
git status # æŸ¥çœ‹çŠ¶æ€å¯ä»¥çœ‹åˆ°æœ‰å¤šå°‘æäº¤
git log --online -num
# 1. é‡ç½®åˆ°è¿œç¨‹æœ€æ–°çŠ¶æ€ï¼ˆ7f68740bï¼‰
PS F:\WorkProject\yunNanWeb> git reset --soft 7f68740b

# 2. æŸ¥çœ‹çŠ¶æ€ - åº”è¯¥åªæ˜¾ç¤ºæ™ºæ…§è°ƒåº¦æ¨¡å—çš„ä¿®æ”¹æ–‡ä»¶
PS F:\WorkProject\yunNanWeb> git status

# 3. æäº¤æ™ºæ…§è°ƒåº¦æ¨¡å—çš„ä¿®æ”¹
PS F:\WorkProject\yunNanWeb> git commit -m "æ™ºæ…§è°ƒåº¦æ¨¡å—åæªï¼ˆä¸“é¡¹ï¼‰ç®¡ç†æ”¹åŠ¨"

# 4. æ¨é€
PS F:\WorkProject\yunNanWeb> git push origin master
```

### å®‰è£…mycat

è§£å‹taråŒ…åˆ°æŒ‡å®šç›®å½•ä¸‹

```
tar -xzf Mycat-server-1.6.7.5-release-20200422133810-linux.tar.gz -C /usr/local
```

å°†é…ç½®æ–‡ä»¶è¦†ç›–ä¸Šå»

```bash
cp /mnt/hgfs/share/partition-enum.txt /usr/local/mycat/conf
cp /mnt/hgfs/share/rule.xml /usr/local/mycat/conf
cp /mnt/hgfs/share/schema.xml /usr/local/mycat/conf
cp /mnt/hgfs/share/server.xml /usr/local/mycat/conf
cp /mnt/hgfs/share/sharding-by-enum.txt /usr/local/mycat/conf
```

é…ç½®æ–‡ä»¶è¯¦æƒ…ï¼š

#### server.xml

```xml
<!--åˆ†å¸ƒå¼äº‹åŠ¡å¼€å…³ï¼Œ0ä¸ºä¸è¿‡æ»¤åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œ1ä¸ºè¿‡æ»¤åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆå¦‚æœåˆ†å¸ƒå¼äº‹åŠ¡å†…åªæ¶‰åŠå…¨å±€è¡¨ï¼Œåˆ™ä¸è¿‡æ»¤ï¼‰ï¼Œ2ä¸ºä¸è¿‡æ»¤åˆ†å¸ƒå¼äº‹åŠ¡,ä½†æ˜¯è®°å½•åˆ†å¸ƒå¼äº‹åŠ¡æ—¥å¿—-->
		<property name="handleDistributedTransactions">0</property>
æŒ‡å®šç«¯å£8066
		<property name="serverPort">8066</property> 
		<property name="managerPort">9066</property>
```

```xml
<user name="rs5000" defaultAccount="true">
		<property name="password">rs5000</property>
		<property name="schemas">dbcenter</property>
		<property name="defaultSchema">dbcenter</property>
		<!--No MyCAT Database selected é”™è¯¯å‰ä¼šå°è¯•ä½¿ç”¨è¯¥schemaä½œä¸ºschemaï¼Œä¸è®¾ç½®åˆ™ä¸ºnull,æŠ¥é”™ -->
    mycatå¯åŠ¨åä¼šå°†æ‰€æœ‰æ•°æ®åº“é›†æˆä¸ºä¸€ä¸ªåº“å°±æ˜¯dbcenter
```

#### schema.xml

```xml
<?xml version="1.0"?>
<!DOCTYPE mycat:schema SYSTEM "schema.dtd">
<mycat:schema xmlns:mycat="http://io.mycat/">

	<schema name="dbcenter" checkSQLschema="true" sqlMaxLimit="100" >
		<!-- auto sharding by id (long) -->
		<!--splitTableNames å¯ç”¨<table name å±æ€§ä½¿ç”¨é€—å·åˆ†å‰²é…ç½®å¤šä¸ªè¡¨,å³å¤šä¸ªè¡¨ä½¿ç”¨è¿™ä¸ªé…ç½®-->
		<!--fetchStoreNodeByJdbc å¯ç”¨ERè¡¨ä½¿ç”¨JDBCæ–¹å¼è·å–DataNode-->


		<!--table name="TB0000_DATABASE,TB0001_SRVTYPE,TB0002_USER,TB0003_NODE,TB0004_USERGROUP,TB0005_SRVCFG,TB0006_SRVPROC,
		TB0007_HOSTPROC,TB0008_EVTDEALMODE,TB0008_RIGHT,TB0009_EVTEXPRESS,TB0009_NODERIGHT,TB0009_USERGROUPRIGHT,TB0010_EVTSORT,
		TB0010_EVTTYPE,TB0011_EVTNOTIFYTYPE,TB0013_SRVSTATUS,TB0014_HOSTSTATUS,TB0017_RDBTABLE,TB0018_RDBFIELD,TB0019_TBLDICT,
		TB0020_FLDDICT,TB0021_RDBMIRROR,TB0022_SYNRTDB ,TB0023_ACCORDTAB,TB0024_SYNTABLE,TB0025_TABLEDESC,TB0026_EVTSTATUSDESC,
		TB0027_EVTTYPELEVEL,TB0037_APPREG,TB1001_DEVTYPE,TB1011_MEASTYPE"  dataNode="dn$0-16"  splitTableNames="true"/-->
  
			<table name="TB1038_AREA" primaryKey="F1038_CODE" dataNode="dn$0-1" rule="sharding-by-enum" needAddLimit="false"/>
		<table name="TB1040_PATROLCENTER" primaryKey="F1040_CODE" dataNode="dn$0-1" rule="sharding-by-enum" needAddLimit="false"/>
		<table name="TB1041_SUBSTATION" primaryKey="F1041_CODE" dataNode="dn$0-1" rule="sharding-by-enum" needAddLimit="false">
			<childTable name="TB1006_ANALOGDATA" primaryKey="F1006_CODE" joinKey="F1041_CODE" parentKey="F1041_CODE" needAddLimit="false"/> 
			<childTable name="TB1016_STATEDATA" primaryKey="F1016_CODE" joinKey="F1041_CODE" parentKey="F1041_CODE" needAddLimit="false"/>
			<childTable name="TB1026_STRINGDATA" primaryKey="F1026_CODE" joinKey="F1041_CODE" parentKey="F1041_CODE" needAddLimit="false"/>
			<childTable name="TB1036_SETTINGDATA" primaryKey="F1036_CODE" joinKey="F1041_CODE" parentKey="F1041_CODE"  needAddLimit="false"/>
			<childTable name="TB1046_IED" primaryKey="F1046_CODE" joinKey="F1041_CODE" parentKey="F1041_CODE" needAddLimit="false"/> 
			<childTable name="TB1043_EQUIPMENT" primaryKey="F1046_CODE" joinKey="F1041_CODE" parentKey="F1041_CODE" needAddLimit="false"/> 
			<childTable name="TB1064_STRAP" primaryKey="F1046_CODE" joinKey="F1041_CODE" parentKey="F1041_CODE" needAddLimit="false"/> 
			<childTable name="TB1077_HARDSTRAP" primaryKey="F1077_CODE" joinKey="F1041_CODE" parentKey="F1041_CODE" needAddLimit="false"/>
			<childTable name="TB1080_SUBSTATIONUNIT" primaryKey="F1046_CODE" joinKey="F1041_CODE" parentKey="F1041_CODE" needAddLimit="false"/>
		</table>

			<table name="tb_faultproductionsupport_his" primaryKey="F1038_CODE" dataNode="dn$0-1" rule="sharding-by-enum" needAddLimit="false"/>
			<table name="ST_TB1046_IED" primaryKey="F1038_CODE" dataNode="dn$0-1" rule="sharding-by-enum" needAddLimit="false"/>
			<table name="TB1101_TAGGROUP" primaryKey="F1038_CODE" dataNode="dn$0-1" rule="sharding-by-enum" needAddLimit="false"/>
			<table name="TB1102_TAGITEM" primaryKey="F1038_CODE" dataNode="dn$0-1" rule="sharding-by-enum" needAddLimit="false"/>
			<table name="TB1107_TAGREPLACE" primaryKey="F1038_CODE" dataNode="dn$0-1" rule="sharding-by-enum" needAddLimit="false"/>
		<table name="tb_substation_stamp,TB_COMPREHENSIVE_APPROVAL_DEVICE,TB_COUNTER_ADVICE,TB_COUNTER_ATTACH,TB_COUNTER_DEVICE_COL,TB_COUNTER_PROJECT_REPORT,TB_TOUR_ATTACHMENT,TB_SUSPEND_RECORD,tb_commstatus_event,TB_RISK_SUPERVISION,TB_RISK_SUPERVISION_DEVICE,TB_RISK_SUPERVISION_RECORD,TB_COMPREHENSIVE_APPROVAL,TB_COMPREHENSIVE_APPROVAL_LOG,TB_COMPREHENSIVE_ATTACH,TB1038_REALAREA,temp_TB1036_SETTINGDATA,TB_TOUR_APPROVAL,TB_SETTING_SHEET_MODEL,TB_CANONICALNAME_APPROVAL,TB_SETTING_SHEET_FAILS,TB1075_STATERMIN,TB_HIS_ANALOG,TB_OMS_FILE_LIST,TB1046_IEDVALUE,TB_FAULTSHORTENDATA,tb_fault_process,tb_fault_connection,tb_fault_attach,TB_FAULTSHORTENEVENT,tb_fault_specification,tb_fault_action_filter,TB_FAULTDETAIL,tb_fault_overhaul,TB_ANALYFAULTDATA,tb_fault_time_format,tb_faultreport,tb_faultevent,TB_APPRAISE_SCORESETTING,TB_APPRAISE_SCORESETTINGRULE,TB_APPRAISE_SYSTEMSETTING,TB_APPRAISE_DEVICE,TB_APPRAISE_CONTENT,TB_APPRAISE_STATISTICS,TB_APPRAISE_HISSCORE,TB_MAINTENANCE_DEV,TB_MAINTENANCEAPP_SHEET,TB_COUNTER_DEVICE,TB_COUNTER_PROJECT,TB_TOUR_TASK,TB_TOUR_CONTENT,TB_TOUR_RANGE,TB_TOUR_REPORT,TB_TOUR_REPORT_CONTENT,TB_TOUR_IEDDETAILEDRESULTS,TB_TOUR_CONTENT_ITEM,TB_TOUR_CONTENT_EVENT,TB1021_SETTINGITEM,TB_HIS_EVENT,MASTER_SERVER_IP_LIST,TB_SETTING_SHEET,TB_SUSPEND_STATUS,TB_PLATE_VERIFICATION_RECORD,TB_ENUMRRATION,,TB1105_TAGRECORDS,TB1110_IEDTAGITEM,TB1111_CONFIRMTAGITEM,
		TB1300_STATSVAL,sys_oper_log,tb_change_shifts_log,tb_acceptance_problem_list,tb_acceptance_task,tb_accessory,tb_check_accept,
		tb_check_accept_problem_list,tb_defect_mgt,tb_feasibility_check,tb_first_design_check,tb_his_memorandum,TB_FILE_CONTEXT,
		tb_ca_design_check_standard_house,tb_scd_management_control,tb_file_signout_log,tb_task_dev_relation,tb_alarm_overhaul_auto_config,
		tb_defect_accessory,tb_defect_flow_log,TB_RISK_INQUIRY,TB_VIOLATIONS_LIST,tb_basic_info_condition,TB_PLATE_VERIFICATION,
		TB_PLATE_VERIFICATION_RECORD,tb_defect_support"  dataNode="dn$0-1"  splitTableNames="true" needAddLimit="false"/>
	</schema>
	<!-- æ•°æ®èŠ‚ç‚¹å®šä¹‰ -->
  
  
	<dataNode name="dn0" dataHost="dh0" database="ora9a"/> 
	<dataNode name="dn1" dataHost="dh0" database="ora9a1"/> 

	<dataHost name="dh0" maxCon="1000" minCon="10" balance="0" writeType="1" dbType="mysql" dbDriver="native" switchType="0"  slaveThreshold="100" >
		<heartbeat>select user()</heartbeat>
		<writeHost host="192.168.16.10" url="192.168.16.10:3306" user="rs5000" password="rs5000">
		</writeHost>
	</dataHost>
</mycat:schema>
```

é€»è¾‘æ¶æ„ï¼š

```
MyCat (é€»è¾‘æ•°æ®åº“: dbcenter)
    â†“
æ•°æ®åˆ†ç‰‡: dn0, dn1
    â†“
ç‰©ç†æ•°æ®åº“: ora9a, ora9a1 (åœ¨åŒä¸€MySQLå®ä¾‹ 192.168.16.10)
```

##### Schema é…ç½®

xml

```
<schema name="dbcenter" checkSQLschema="true" sqlMaxLimit="100">
```

- **é€»è¾‘æ•°æ®åº“å**: `dbcenter`
- **è‡ªåŠ¨å»é™¤Schema**: `checkSQLschema="true"`
- **é»˜è®¤æŸ¥è¯¢é™åˆ¶**: `sqlMaxLimit="100"`ï¼ˆé˜²æ­¢å…¨è¡¨æ‰«æï¼‰

##### æ•°æ®åˆ†ç‰‡é…ç½®

xml

```
<dataNode name="dn0" dataHost="dh0" database="ora9a"/>
<dataNode name="dn1" dataHost="dh0" database="ora9a1"/>
```

- **dn0**: æŒ‡å‘ç‰©ç†æ•°æ®åº“ `ora9a`
- **dn1**: æŒ‡å‘ç‰©ç†æ•°æ®åº“ `ora9a1`
- **åŒä¸€ç‰©ç†ä¸»æœº**: éƒ½åœ¨ `192.168.16.10`

##### ç‰©ç†æ•°æ®æºé…ç½®

xml

```
<dataHost name="dh0" maxCon="1000" minCon="10" balance="0" 
          writeType="1" dbType="mysql" dbDriver="native">
    <writeHost host="192.168.16.10" url="192.168.16.10:3306" 
               user="rs5000" password="rs5000"/>
</dataHost>
```

- **è¿æ¥æ± **: æœ€å¤§1000è¿æ¥ï¼Œæœ€å°10è¿æ¥
- **æ— è¯»å†™åˆ†ç¦»**: `balance="0"`
- **MySQLæ•°æ®åº“**: ä½¿ç”¨åŸç”Ÿé©±åŠ¨

##### çˆ¶å­è¡¨å…³ç³»ï¼ˆERè¡¨ï¼‰

xml

```
<table name="TB1041_SUBSTATION" primaryKey="F1041_CODE" dataNode="dn$0-1" 
       rule="sharding-by-enum" needAddLimit="false">
    <childTable name="TB1006_ANALOGDATA" primaryKey="F1006_CODE" 
                joinKey="F1041_CODE" parentKey="F1041_CODE"/>
```

**ä¸šåŠ¡å«ä¹‰**: å˜ç”µç«™(TB1041_SUBSTATION)ä½œä¸ºçˆ¶è¡¨ï¼Œå…¶ç›¸å…³çš„ï¼š

- æ¨¡æ‹Ÿé‡æ•°æ®(TB1006_ANALOGDATA)
- çŠ¶æ€é‡æ•°æ®(TB1016_STATEDATA)
- äºŒæ¬¡è£…ç½®(TB1046_IED)
- ä¸€æ¬¡è®¾å¤‡(TB1043_EQUIPMENT)ç­‰

**ç¡®ä¿å…³è”æ•°æ®åœ¨åŒä¸€åˆ†ç‰‡**ï¼Œé¿å…è·¨åˆ†ç‰‡JOINã€‚

##### åˆ†ç‰‡è§„åˆ™

- **æ‰€æœ‰è¡¨**: `dataNode="dn$0-1"` + `rule="sharding-by-enum"`
- **æšä¸¾åˆ†ç‰‡**: æ ¹æ®æŸä¸ªæšä¸¾å­—æ®µçš„å€¼å†³å®šåˆ†é…åˆ° dn0 æˆ– dn1

#### sharding-by-enum.txt

![image-20251106170440235](https://cdn.jsdelivr.net/gh/lyc45678/image@master/img/20251106170508020.png)

#### partition-enum.txt

```txt
yunnan=0
honghe=1
```

#### rule.xml

##### ä¸»è¦ä½¿ç”¨çš„åˆ†ç‰‡è§„åˆ™

###### `sharding-by-enum` (æšä¸¾åˆ†ç‰‡)

xml

```
<tableRule name="sharding-by-enum">
    <rule>
        <columns>F1038_CODE</columns>
        <algorithm>func-enum</algorithm>
    </rule>
</tableRule>
```

**ç”¨é€”**: æ ¹æ®åœ°åŒºä»£ç (F1038_CODE)è¿›è¡Œåˆ†ç‰‡
**å¯¹åº”å‡½æ•°**: `func-enum` â†’ ä½¿ç”¨ `partition-enum.txt` æ˜ å°„æ–‡ä»¶

###### `sharding-by-mutil-fields` (å¤šå­—æ®µåˆ†ç‰‡)

xml

```
<tableRule name="sharding-by-mutil-fields">
    <rule>
        <columns>F1041_CODE</columns>
        <algorithm>partbymonth</algorithm>
    </rule>
</tableRule>
```

**ç”¨é€”**: æ ¹æ®å˜ç”µç«™ä»£ç (F1041_CODE)æŒ‰æœˆåˆ†ç‰‡

##### **åˆ†ç‰‡å‡½æ•°è¯¦è§£**

###### `func-enum` - æšä¸¾åˆ†ç‰‡

xml

```
<function name="func-enum" class="io.mycat.route.function.PartitionByFileMap">
    <property name="type">1</property>
    <property name="mapFile">partition-enum.txt</property>
</function>
```

**é…ç½®æ–‡ä»¶**: `partition-enum.txt`
**ç¤ºä¾‹å†…å®¹**:

```
yunnan=0
honghe=1
```

###### `partbymonth` - æŒ‰æœˆåˆ†ç‰‡

xml

```
<function name="partbymonth" class="io.mycat.route.function.PartitionByMonth">
    <property name="dateFormat">yyyy-MM-dd</property>
    <property name="sBeginDate">2024-01-01</property>
</function>
```

**ç”¨é€”**: ä»2024å¹´1æœˆå¼€å§‹æŒ‰æœˆåˆ†ç‰‡

###### åœ°åŒºç»´åº¦åˆ†ç‰‡

xml

```
<!-- ä½¿ç”¨ F1038_CODE (åœ°åŒºä»£ç ) -->
<tableRule name="sharding-by-enum">
    <columns>F1038_CODE</columns>
    <algorithm>func-enum</algorithm>
</tableRule>
```

**åº”ç”¨è¡¨**:

- `TB1038_AREA` (åœ°åŒºè¡¨)
- `TB1101_TAGGROUP` (æ ‡ç­¾ç»„)
- `TB1102_TAGITEM` (æ ‡ç­¾é¡¹)

###### å˜ç”µç«™ç»´åº¦åˆ†ç‰‡

xml

```
<!-- ä½¿ç”¨ F1041_CODE (å˜ç”µç«™ä»£ç ) -->
<tableRule name="sharding-by-mutil-fields">
    <columns>F1041_CODE</columns>
    <algorithm>partbymonth</algorithm>
</tableRule>
```

**åº”ç”¨è¡¨**: `TB1041_SUBSTATION` åŠå…¶å­è¡¨

### å¯åŠ¨mycat

```
[root@localhost mycat]# ./bin/mycat start
```

```
mysql -h 127.0.0.1 -P 8066 -u rs5000 -p'rs5000' 
```

### éƒ¨ç½²rs5000ç³»ç»Ÿ

è§£å‹taråŒ…åˆ°/opt/java/ä¸‹ï¼Œé…ç½®ç¯å¢ƒå˜é‡

```
tar -xvf rs5000_2025-11-06_144654(1).tar.gz -C /opt/java
```

```
tar -xvf qt.tar.gz -C /opt/java
```

```bash
vim ~/.bashrc
```

```
 export SYHHOME=/opt/java/rs5000
 export QTDIR=/opt/java/qt3.3.8
 export PATH=$SYHHOME/bin:$PATH
 export LD_LIBRARY_PATH=$SYHHOME/lib:$LIBRARY_PATH:$QTDIR/lib

```

æ³¨å†Œï¼š

```bash
./opt/java/rs5000/bin/register
```

å¾—åˆ°ä¸€ä¸²æ•°å­—ï¼š

2758D2158BB4AD676A666F15444EF770

è·å–æ³¨å†Œç ï¼š

æ³¨å†Œç :D8EA-EEA0-1287-0C24-6CF8-D7DF-A215-B942

è¾“å…¥dbtool

ä¿®æ”¹é…ç½®

![image-20251106203434328](https://cdn.jsdelivr.net/gh/lyc45678/image@master/img/20251106203515581.png)

å¯ä»¥åœ¨ç»ˆç«¯ä¸Šè¾“å…¥hostnameæŸ¥çœ‹æ˜¯å¦ä¸€è‡´

é…ç½®æœåŠ¡è¿›ç¨‹

![image-20251106203614709](https://cdn.jsdelivr.net/gh/lyc45678/image@master/img/20251106203614923.png)

åŠ ä¸Šå‘¨æœŸå·¡è§†ï¼Œå¯åŠ¨æ¨¡å¼å®šæ—¶ï¼Œå¯åŠ¨é¡ºåºéšæœº

é…ç½®å®Œæˆ

å¯åŠ¨ï¼

åœ¨ç»ˆç«¯ä¸Šè¾“å…¥softbuså³å¯ã€‚

é—®é¢˜è§£å†³ï¼š

é¦–å…ˆå…ˆæŸ¥è¯¢å‚ç«™è¡¨ï¼Œ1041è¡¨

æŸ¥åˆ°æŒ‡å®šçš„1041codeååœ¨å»æŸ¥è¯¢ä¸€æ¬¡è£…ç½®è¡¨1043è¡¨

æŸ¥è¯¢ä¹‹åå†å»æŸ¥è¯¢1046è¡¨ä¸­æœ‰ä¸€æ¬¡è£…ç½®çš„è®¾å¤‡æ•°

åœ¨æŸ¥è¯¢æŒ‡å®šå‚ç«™ä¸­æœ‰äºŒæ¬¡è®¾å¤‡ï¼Œæ²¡æœ‰ä¸€æ¬¡è£…ç½®çš„è®¾å¤‡æ•°

### ä¼˜åŒ–è™šæ‹Ÿæœºå†…å­˜

#### ç«‹å³å¢åŠ äº¤æ¢ç©ºé—´ï¼š

```
# 1. åˆ›å»ºæ–°çš„äº¤æ¢æ–‡ä»¶ï¼ˆ4GBï¼‰
sudo fallocate -l 4G /swapfile2

# 2. è®¾ç½®æƒé™
sudo chmod 600 /swapfile2

# 3. æ ¼å¼åŒ–ä¸ºäº¤æ¢ç©ºé—´
sudo mkswap /swapfile2

# 4. ç«‹å³å¯ç”¨
sudo swapon /swapfile2

# 5. éªŒè¯
swapon --show
free -h
```

#### è°ƒæ•´swappinessï¼š

```
# ç«‹å³è°ƒæ•´
echo 60 > /proc/sys/vm/swappiness

# æ°¸ä¹…è®¾ç½®
echo "vm.swappiness = 60" >> /etc/sysctl.conf
sysctl -p
```

#### **æ°¸ä¹…æ·»åŠ äº¤æ¢æ–‡ä»¶**ï¼š

```
# æ·»åŠ åˆ° /etc/fstab
echo '/swapfile2 none swap sw 0 0' >> /etc/fstab
```

#### ä¼˜åŒ–MySQLæœåŠ¡

ä¼˜åŒ–é…ç½®æ–‡ä»¶

```bash
vim /etc/my.cnf
```

ä¿®æ”¹å†…å®¹å¦‚ä¸‹ï¼š

```ini
[mysqld]
# ç¼“å†²æ± ä¼˜åŒ– - åŸºäºå½“å‰ 8192 pages (128MB) ä½†å‘½ä¸­ç‡ä½
innodb_buffer_pool_size = 1G           # å¢åŠ åˆ° 1G æé«˜å‘½ä¸­ç‡
innodb_buffer_pool_instances = 2
innodb_lru_scan_depth = 256           # è§£å†³ LRU å‹åŠ›

# I/O ä¼˜åŒ–
innodb_io_capacity = 2000
innodb_io_capacity_max = 4000
innodb_flush_method = O_DIRECT
innodb_flush_neighbors = 0

# æ—¥å¿—ä¼˜åŒ–
innodb_log_file_size = 256M
innodb_log_buffer_size = 32M

# è¿æ¥å’Œçº¿ç¨‹ä¼˜åŒ–
max_connections = 100
thread_cache_size = 16
table_open_cache = 1024

# æ€§èƒ½æ¨¡å¼å…³é—­ä»¥èŠ‚çœå†…å­˜
performance_schema = OFF

# æŸ¥è¯¢ç¼“å­˜å…³é—­
query_cache_size = 0
query_cache_type = 0

# ä¸´æ—¶è¡¨ä¼˜åŒ–
tmp_table_size = 64M
max_heap_table_size = 64M

# å…¶ä»–å…³é”®ä¼˜åŒ–
innodb_adaptive_hash_index = 0        # å…³é—­è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ï¼Œå‡å°‘äº‰ç”¨
innodb_purge_threads = 2
innodb_read_io_threads = 8
innodb_write_io_threads = 8

```

æœ€åé‡å¯mysqlæœåŠ¡å³å¯

```bash
systemctl restart mysqld.service

```

#### ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡

```bash
# ä»¥ä¸‹æœåŠ¡å¯ä»¥è€ƒè™‘ç¦ç”¨ï¼ˆå¦‚æœä¸éœ€è¦ï¼‰
systemctl stop bluetooth.service
systemctl disable bluetooth.service

systemctl stop ModemManager.service  
systemctl disable ModemManager.service

systemctl stop libstoragemgmt.service
systemctl disable libstoragemgmt.service
#bluetooth.service - è“ç‰™æœåŠ¡ï¼ˆæœåŠ¡å™¨é€šå¸¸ä¸éœ€è¦è“ç‰™ï¼‰

#ModemManager.service - è°ƒåˆ¶è§£è°ƒå™¨ç®¡ç†ï¼ˆæœåŠ¡å™¨ä¸éœ€è¦æ‹¨å·ä¸Šç½‘ï¼‰

#libstoragemgmt.service - å­˜å‚¨ç®¡ç†æ’ä»¶æœåŠ¡ï¼ˆé™¤éæœ‰ç‰¹å®šå­˜å‚¨è®¾å¤‡ï¼‰

```

#### ä¼˜åŒ–nacosæœåŠ¡

ç¼–è¾‘nacosæ‰§è¡Œè„šæœ¬

```bash
vim /opt/java/nacos/bin/startup.sh
```

å› ä¸ºæ‰§è¡Œçš„æ˜¯å•ä¸€æ¨¡å¼ï¼Œ

å³ï¼š -m standaloneæ¨¡å¼

æ‰€ä»¥æ˜¯åœ¨è¯¥æ¨¡å¼ä¸‹ä¿®æ”¹

```bash
# ç¼–è¾‘Nacoså¯åŠ¨è„šæœ¬ï¼Œå°†ï¼š
-Xms512m -Xmx512m
# æ”¹ä¸ºï¼š
-Xms256m -Xmx256m -Xmn128m
```

#### ä¼˜åŒ–tomcatæœåŠ¡

##### åˆ›å»ºTomcatå†…å­˜ä¼˜åŒ–é…ç½®

```bash
# è¿›å…¥Tomcatçš„binç›®å½•
cd /opt/java/apache-tomcat-7.0.104/bin

# åˆ›å»ºsetenv.shå†…å­˜ä¼˜åŒ–æ–‡ä»¶
cat > setenv.sh << 'EOF'
#!/bin/sh
# Tomcat JVMå†…å­˜ä¼˜åŒ–é…ç½®
export JAVA_OPTS="$JAVA_OPTS -Xms256m -Xmx256m -XX:MaxMetaspaceSize=128m"
export JAVA_OPTS="$JAVA_OPTS -XX:+UseG1GC -XX:MaxGCPauseMillis=200"
export JAVA_OPTS="$JAVA_OPTS -XX:+DisableExplicitGC"
EOF

# ç»™æ‰§è¡Œæƒé™
chmod +x setenv.sh

# æŸ¥çœ‹åˆ›å»ºçš„æ–‡ä»¶
cat setenv.sh
```

##### ğŸš€ é‡æ–°å¯åŠ¨Tomcat

```bash
# å¯åŠ¨Tomcat
./startup.sh
```

### è§£å†³MySQLå†…å­˜æ³„æ¼é—®é¢˜

ä¿®æ”¹é…ç½®æ–‡ä»¶

```bash
vim /etc/my.cnf
```

å¦‚ä¸‹å›¾ä¿®æ”¹

```ini
[mysql]
default-character-set=utf8mb4

[client]
port=3306
default-character-set=utf8mb4

[mysqld]
character-set-server=utf8mb4
default-storage-engine=INNODB
port=3306

# å®‰è£…è·¯å¾„
basedir = /opt/java/mysql-5.7.18-linux-glibc2.5-x86_64
datadir = /opt/java/mysql-5.7.18-linux-glibc2.5-x86_64/data
pid-file = /opt/java/mysql-5.7.18-linux-glibc2.5-x86_64/data/mysqld.pid

lower_case_table_names=1
sql_mode=''

# ========== å…³é”®å†…å­˜ä¼˜åŒ– ==========
# ç¼“å†²æ± ä¼˜åŒ– - å¤§å¹…é™ä½åˆ°åˆç†èŒƒå›´
innodb_buffer_pool_size = 256M           # ä»1Gé™åˆ°256M
innodb_buffer_pool_instances = 1         # å°å†…å­˜ç”¨å•ä¸ªå®ä¾‹
innodb_lru_scan_depth = 128              # é™ä½æ‰«ææ·±åº¦

# I/O ä¼˜åŒ–
innodb_io_capacity = 1000                # é™ä½IOå®¹é‡
innodb_io_capacity_max = 2000
innodb_flush_method = O_DIRECT
innodb_flush_neighbors = 0

# æ—¥å¿—ä¼˜åŒ– - å¤§å¹…å‡å°
innodb_log_file_size = 64M               # ä»256Mé™åˆ°64M
innodb_log_buffer_size = 16M             # ä»32Mé™åˆ°16M

# è¿æ¥ä¼˜åŒ– - æ ¹æ®å®é™…ä½¿ç”¨è°ƒæ•´
max_connections = 30                     # ä»100é™åˆ°30
max_connect_errors = 10
thread_cache_size = 8                    # ä»16é™åˆ°8
table_open_cache = 400                   # ä»1024é™åˆ°400

# æ€§èƒ½æ¨¡å¼å…³é—­ä»¥èŠ‚çœå†…å­˜
performance_schema = OFF

# æŸ¥è¯¢ç¼“å­˜å…³é—­
query_cache_size = 0
query_cache_type = 0

# ä¸´æ—¶è¡¨ä¼˜åŒ–
tmp_table_size = 32M                     # ä»64Mé™åˆ°32M
max_heap_table_size = 32M

# å…¶ä»–ä¼˜åŒ–
innodb_adaptive_hash_index = 0
innodb_purge_threads = 1                 # å°ç³»ç»Ÿç”¨1ä¸ªçº¿ç¨‹
innodb_read_io_threads = 4               # å‡å°‘IOçº¿ç¨‹
innodb_write_io_threads = 4

# æ–°å¢ï¼šé™åˆ¶æ¯ä¸ªè¿æ¥çš„å†…å­˜ä½¿ç”¨
read_buffer_size = 128K
read_rnd_buffer_size = 256K
sort_buffer_size = 256K
join_buffer_size = 128K
```

æœ€åé‡å¯MySQLæœåŠ¡å³å¯




æ¨¡å‹æ–‡ä»¶æ”¾ç½®ä½ç½®ï¼š /home/rs5000/rs5000/tmp/filedataasync/
